<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloak & Cannon</title>
    <meta name="description"
        content="Cloak & Cannon is a top-down tactical stealth tank game. Infiltrate enemy lines, avoid sentries, and complete your mission in this intense browser-based arcade experience.">
    <meta name="keywords" content="tank game, stealth game, browser game, phaser.js, arcade, action, tactical">
    <meta name="robots" content="index, follow">
    <link rel="icon" href="https://imagedelivery.net/PwwFoxX145pJ1GHCG1Npzg/74faf358-754d-4a62-9543-a9bb6106aa00/public"
        type="image/svg+xml">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');

        body {
            margin: 0;
            padding: 0;
            background-color: #050505;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Orbitron', sans-serif;
            color: #ecf0f1;
        }

        #game-container {
            position: relative;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
            border: none;
            width: 100%;
            height: 100vh;
        }

        #ui-layer {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 200px;
            background: rgba(10, 15, 20, 0.85);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(100, 200, 255, 0.2);
            border-radius: 4px;
            padding: 10px;
            pointer-events: none;
        }

        h2 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #00d2ff;
            text-transform: uppercase;
            border-bottom: 1px solid rgba(0, 210, 255, 0.3);
            padding-bottom: 5px;
        }

        .crew-member {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 5px;
            color: #bdc3c7;
        }

        .crew-role {
            color: #7f8c8d;
            font-size: 10px;
        }

        .status-ok {
            color: #2ecc71;
        }

        .status-alert {
            color: #e74c3c;
        }

        #mission-status {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(10, 15, 20, 0.85);
            padding: 10px;
            border: 1px solid #e67e22;
            color: #e67e22;
            font-size: 14px;
            font-weight: bold;
            display: none;
            pointer-events: none;
        }
    </style>
</head>

<body>

    <div id="game-container">
        <div id="ui-layer">
            <h2>Tank Crew</h2>
            <div class="crew-member">
                <span>Simon</span> <span class="crew-role">CMDR</span> <span class="status-ok">ACTIVE</span>
            </div>
            <div class="crew-member">
                <span>Louis</span> <span class="crew-role">GNR</span> <span class="status-ok">ACTIVE</span>
            </div>
            <div class="crew-member">
                <span>Remy</span> <span class="crew-role">DRVR</span> <span class="status-ok">ACTIVE</span>
            </div>
            <div class="crew-member">
                <span>Jules</span> <span class="crew-role">LDR</span> <span class="status-ok">ACTIVE</span>
            </div>
        </div>
        <div id="mission-status">OBJECTIVE SECURED! RETURN TO EXTRACT!</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser-navmesh/dist/phaser-navmesh.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser-navmesh@2.2.0/dist/phaser-navmesh.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/gh/rexrainbow/phaser3-rex-notes@master/dist/rexvirtualjoystickplugin.min.js"></script>
    <script>
        const ASSET_URL = 'https://imagedelivery.net/PwwFoxX145pJ1GHCG1Npzg/2725ffe6-68a3-4f76-e90b-7dd61b44ac00/public';

        const ATLAS_JSON = {
            "frames": {
                "barrelBlack_side.png": { "frame": { "x": 513, "y": 407, "w": 20, "h": 28 } },
                "barrelBlack_top.png": { "frame": { "x": 507, "y": 515, "w": 24, "h": 24 } },
                "barrelGreen_side.png": { "frame": { "x": 513, "y": 319, "w": 20, "h": 28 } },
                "barrelGreen_top.png": { "frame": { "x": 507, "y": 443, "w": 24, "h": 24 } },
                "barrelRed_side.png": { "frame": { "x": 414, "y": 371, "w": 20, "h": 28 } },
                "barrelRed_top.png": { "frame": { "x": 507, "y": 491, "w": 24, "h": 24 } },
                "barrelRust_side.png": { "frame": { "x": 512, "y": 40, "w": 20, "h": 28 } },
                "barrelRust_top.png": { "frame": { "x": 507, "y": 467, "w": 24, "h": 24 } },
                "barricadeMetal.png": { "frame": { "x": 479, "y": 499, "w": 28, "h": 28 } },
                "barricadeWood.png": { "frame": { "x": 479, "y": 527, "w": 28, "h": 28 } },
                "bulletBlue1.png": { "frame": { "x": 356, "y": 555, "w": 4, "h": 10 } },
                "bulletBlue1_outline.png": { "frame": { "x": 544, "y": 26, "w": 8, "h": 14 } },
                "bulletBlue2.png": { "frame": { "x": 532, "y": 48, "w": 8, "h": 12 } },
                "bulletBlue2_outline.png": { "frame": { "x": 438, "y": 455, "w": 12, "h": 16 } },
                "bulletBlue3.png": { "frame": { "x": 500, "y": 130, "w": 4, "h": 14 } },
                "bulletBlue3_outline.png": { "frame": { "x": 513, "y": 202, "w": 8, "h": 18 } },
                "bulletDark1.png": { "frame": { "x": 386, "y": 393, "w": 4, "h": 10 } },
                "bulletDark1_outline.png": { "frame": { "x": 462, "y": 455, "w": 8, "h": 14 } },
                "bulletDark2.png": { "frame": { "x": 470, "y": 455, "w": 8, "h": 12 } },
                "bulletDark2_outline.png": { "frame": { "x": 196, "y": 544, "w": 12, "h": 16 } },
                "bulletDark3.png": { "frame": { "x": 435, "y": 231, "w": 4, "h": 14 } },
                "bulletDark3_outline.png": { "frame": { "x": 531, "y": 517, "w": 8, "h": 18 } },
                "bulletGreen1.png": { "frame": { "x": 435, "y": 245, "w": 4, "h": 10 } },
                "bulletGreen1_outline.png": { "frame": { "x": 532, "y": 160, "w": 8, "h": 14 } },
                "bulletGreen2.png": { "frame": { "x": 521, "y": 202, "w": 8, "h": 12 } },
                "bulletGreen2_outline.png": { "frame": { "x": 172, "y": 544, "w": 12, "h": 16 } },
                "bulletGreen3.png": { "frame": { "x": 471, "y": 283, "w": 4, "h": 14 } },
                "bulletGreen3_outline.png": { "frame": { "x": 492, "y": 130, "w": 8, "h": 18 } },
                "bulletRed1.png": { "frame": { "x": 382, "y": 393, "w": 4, "h": 10 } },
                "bulletRed1_outline.png": { "frame": { "x": 344, "y": 551, "w": 8, "h": 14 } },
                "bulletRed2.png": { "frame": { "x": 336, "y": 551, "w": 8, "h": 12 } },
                "bulletRed2_outline.png": { "frame": { "x": 184, "y": 544, "w": 12, "h": 16 } },
                "bulletRed3.png": { "frame": { "x": 206, "y": 528, "w": 4, "h": 14 } },
                "bulletRed3_outline.png": { "frame": { "x": 484, "y": 130, "w": 8, "h": 18 } },
                "bulletSand1.png": { "frame": { "x": 352, "y": 555, "w": 4, "h": 10 } },
                "bulletSand1_outline.png": { "frame": { "x": 320, "y": 551, "w": 8, "h": 14 } },
                "bulletSand2.png": { "frame": { "x": 312, "y": 551, "w": 8, "h": 12 } },
                "bulletSand2_outline.png": { "frame": { "x": 450, "y": 455, "w": 12, "h": 16 } },
                "bulletSand3.png": { "frame": { "x": 471, "y": 297, "w": 4, "h": 14 } },
                "bulletSand3_outline.png": { "frame": { "x": 476, "y": 130, "w": 8, "h": 18 } },
                "crateMetal.png": { "frame": { "x": 479, "y": 471, "w": 28, "h": 28 } },
                "crateMetal_side.png": { "frame": { "x": 479, "y": 443, "w": 28, "h": 28 } },
                "crateWood.png": { "frame": { "x": 480, "y": 221, "w": 28, "h": 28 } },
                "crateWood_side.png": { "frame": { "x": 480, "y": 249, "w": 28, "h": 28 } },
                "explosion1.png": { "frame": { "x": 320, "y": 403, "w": 60, "h": 60 } },
                "explosion2.png": { "frame": { "x": 380, "y": 471, "w": 57, "h": 56 } },
                "explosion3.png": { "frame": { "x": 0, "y": 128, "w": 64, "h": 63 } },
                "explosion4.png": { "frame": { "x": 430, "y": 104, "w": 46, "h": 45 } },
                "explosion5.png": { "frame": { "x": 53, "y": 512, "w": 53, "h": 52 } },
                "explosionSmoke1.png": { "frame": { "x": 320, "y": 463, "w": 60, "h": 60 } },
                "explosionSmoke2.png": { "frame": { "x": 382, "y": 255, "w": 57, "h": 56 } },
                "explosionSmoke3.png": { "frame": { "x": 320, "y": 192, "w": 63, "h": 63 } },
                "explosionSmoke4.png": { "frame": { "x": 384, "y": 104, "w": 46, "h": 45 } },
                "explosionSmoke5.png": { "frame": { "x": 0, "y": 512, "w": 53, "h": 52 } },
                "fenceRed.png": { "frame": { "x": 158, "y": 528, "w": 48, "h": 16 } },
                "fenceYellow.png": { "frame": { "x": 158, "y": 512, "w": 52, "h": 16 } },
                "oilSpill_large.png": { "frame": { "x": 262, "y": 512, "w": 50, "h": 50 } },
                "oilSpill_small.png": { "frame": { "x": 158, "y": 544, "w": 14, "h": 14 } },
                "sandbagBeige.png": { "frame": { "x": 382, "y": 371, "w": 32, "h": 22 } },
                "sandbagBeige_open.png": { "frame": { "x": 354, "y": 527, "w": 42, "h": 28 } },
                "sandbagBrown.png": { "frame": { "x": 439, "y": 283, "w": 32, "h": 22 } },
                "sandbagBrown_open.png": { "frame": { "x": 312, "y": 523, "w": 42, "h": 28 } },
                "shotLarge.png": { "frame": { "x": 507, "y": 539, "w": 20, "h": 25 } },
                "shotOrange.png": { "frame": { "x": 514, "y": 289, "w": 16, "h": 28 } },
                "shotRed.png": { "frame": { "x": 508, "y": 221, "w": 21, "h": 38 } },
                "shotThin.png": { "frame": { "x": 546, "y": 160, "w": 8, "h": 26 } },
                "specialBarrel1.png": { "frame": { "x": 530, "y": 0, "w": 14, "h": 22 } },
                "specialBarrel1_outline.png": { "frame": { "x": 527, "y": 539, "w": 18, "h": 26 } },
                "specialBarrel2.png": { "frame": { "x": 544, "y": 108, "w": 12, "h": 24 } },
                "specialBarrel2_outline.png": { "frame": { "x": 513, "y": 174, "w": 16, "h": 28 } },
                "specialBarrel3.png": { "frame": { "x": 544, "y": 132, "w": 10, "h": 28 } },
                "specialBarrel3_outline.png": { "frame": { "x": 530, "y": 244, "w": 14, "h": 32 } },
                "specialBarrel4.png": { "frame": { "x": 544, "y": 244, "w": 10, "h": 32 } },
                "specialBarrel4_outline.png": { "frame": { "x": 530, "y": 276, "w": 14, "h": 36 } },
                "specialBarrel5.png": { "frame": { "x": 531, "y": 435, "w": 12, "h": 26 } },
                "specialBarrel5_outline.png": { "frame": { "x": 514, "y": 98, "w": 16, "h": 30 } },
                "specialBarrel6.png": { "frame": { "x": 544, "y": 276, "w": 8, "h": 26 } },
                "specialBarrel6_outline.png": { "frame": { "x": 533, "y": 312, "w": 12, "h": 30 } },
                "specialBarrel7.png": { "frame": { "x": 544, "y": 0, "w": 8, "h": 26 } },
                "specialBarrel7_outline.png": { "frame": { "x": 530, "y": 68, "w": 12, "h": 30 } },
                "tankBlue_barrel1.png": { "frame": { "x": 531, "y": 461, "w": 12, "h": 26 } },
                "tankBlue_barrel1_outline.png": { "frame": { "x": 514, "y": 259, "w": 16, "h": 30 } },
                "tankBlue_barrel2.png": { "frame": { "x": 545, "y": 302, "w": 8, "h": 26 } },
                "tankBlue_barrel2_outline.png": { "frame": { "x": 542, "y": 48, "w": 12, "h": 30 } },
                "tankBlue_barrel3.png": { "frame": { "x": 545, "y": 519, "w": 8, "h": 26 } },
                "tankBlue_barrel3_outline.png": { "frame": { "x": 543, "y": 459, "w": 12, "h": 30 } },
                "tankBody_bigRed.png": { "frame": { "x": 384, "y": 56, "w": 48, "h": 48 } },
                "tankBody_bigRed_outline.png": { "frame": { "x": 106, "y": 512, "w": 52, "h": 52 } },
                "tankBody_blue.png": { "frame": { "x": 396, "y": 527, "w": 38, "h": 38 } },
                "tankBody_blue_outline.png": { "frame": { "x": 426, "y": 149, "w": 42, "h": 42 } },
                "tankBody_dark.png": { "frame": { "x": 468, "y": 149, "w": 38, "h": 36 } },
                "tankBody_darkLarge.png": { "frame": { "x": 384, "y": 0, "w": 48, "h": 56 } },
                "tankBody_darkLarge_outline.png": { "frame": { "x": 382, "y": 311, "w": 52, "h": 60 } },
                "tankBody_dark_outline.png": { "frame": { "x": 384, "y": 149, "w": 42, "h": 40 } },
                "tankBody_green.png": { "frame": { "x": 476, "y": 283, "w": 38, "h": 36 } },
                "tankBody_green_outline.png": { "frame": { "x": 435, "y": 191, "w": 42, "h": 40 } },
                "tankBody_huge.png": { "frame": { "x": 380, "y": 403, "w": 58, "h": 68 } },
                "tankBody_huge_outline.png": { "frame": { "x": 320, "y": 331, "w": 62, "h": 72 } },
                "tankBody_red.png": { "frame": { "x": 479, "y": 407, "w": 34, "h": 36 } },
                "tankBody_red_outline.png": { "frame": { "x": 476, "y": 0, "w": 38, "h": 40 } },
                "tankBody_sand.png": { "frame": { "x": 476, "y": 94, "w": 38, "h": 36 } },
                "tankBody_sand_outline.png": { "frame": { "x": 437, "y": 517, "w": 42, "h": 40 } },
                "tankDark_barrel1.png": { "frame": { "x": 543, "y": 342, "w": 12, "h": 26 } },
                "tankDark_barrel1_outline.png": { "frame": { "x": 514, "y": 68, "w": 16, "h": 30 } },
                "tankDark_barrel2.png": { "frame": { "x": 545, "y": 398, "w": 8, "h": 26 } },
                "tankDark_barrel2_outline.png": { "frame": { "x": 531, "y": 373, "w": 12, "h": 30 } },
                "tankDark_barrel3.png": { "frame": { "x": 553, "y": 519, "w": 8, "h": 26 } },
                "tankDark_barrel3_outline.png": { "frame": { "x": 543, "y": 429, "w": 12, "h": 30 } },
                "tankGreen_barrel1.png": { "frame": { "x": 533, "y": 403, "w": 12, "h": 26 } },
                "tankGreen_barrel1_outline.png": { "frame": { "x": 515, "y": 377, "w": 16, "h": 30 } },
                "tankGreen_barrel2.png": { "frame": { "x": 553, "y": 398, "w": 8, "h": 26 } },
                "tankGreen_barrel2_outline.png": { "frame": { "x": 530, "y": 98, "w": 12, "h": 30 } },
                "tankGreen_barrel3.png": { "frame": { "x": 552, "y": 276, "w": 8, "h": 26 } },
                "tankGreen_barrel3_outline.png": { "frame": { "x": 531, "y": 487, "w": 12, "h": 30 } },
                "tankRed_barrel1.png": { "frame": { "x": 531, "y": 347, "w": 12, "h": 26 } },
                "tankRed_barrel1_outline.png": { "frame": { "x": 514, "y": 0, "w": 16, "h": 30 } },
                "tankRed_barrel2.png": { "frame": { "x": 546, "y": 212, "w": 8, "h": 26 } },
                "tankRed_barrel2_outline.png": { "frame": { "x": 543, "y": 368, "w": 12, "h": 30 } },
                "tankRed_barrel3.png": { "frame": { "x": 553, "y": 302, "w": 8, "h": 26 } },
                "tankRed_barrel3_outline.png": { "frame": { "x": 532, "y": 128, "w": 12, "h": 30 } },
                "tankSand_barrel1.png": { "frame": { "x": 532, "y": 22, "w": 12, "h": 26 } },
                "tankSand_barrel1_outline.png": { "frame": { "x": 515, "y": 347, "w": 16, "h": 30 } },
                "tankSand_barrel2.png": { "frame": { "x": 546, "y": 186, "w": 8, "h": 26 } },
                "tankSand_barrel2_outline.png": { "frame": { "x": 542, "y": 78, "w": 12, "h": 30 } },
                "tankSand_barrel3.png": { "frame": { "x": 552, "y": 0, "w": 8, "h": 26 } },
                "tankSand_barrel3_outline.png": { "frame": { "x": 543, "y": 489, "w": 12, "h": 30 } },
                "tank_bigRed.png": { "frame": { "x": 210, "y": 512, "w": 52, "h": 52 } },
                "tank_blue.png": { "frame": { "x": 432, "y": 48, "w": 42, "h": 46 } },
                "tank_dark.png": { "frame": { "x": 434, "y": 311, "w": 42, "h": 46 } },
                "tank_darkLarge.png": { "frame": { "x": 383, "y": 192, "w": 52, "h": 60 } },
                "tank_green.png": { "frame": { "x": 434, "y": 357, "w": 42, "h": 46 } },
                "tank_huge.png": { "frame": { "x": 320, "y": 255, "w": 62, "h": 76 } },
                "tank_red.png": { "frame": { "x": 474, "y": 48, "w": 38, "h": 46 } },
                "tank_sand.png": { "frame": { "x": 437, "y": 471, "w": 42, "h": 46 } },
                "tileGrass1.png": { "frame": { "x": 192, "y": 384, "w": 64, "h": 64 } },
                "tileGrass2.png": { "frame": { "x": 192, "y": 320, "w": 64, "h": 64 } },
                "tileGrass_roadCornerLL.png": { "frame": { "x": 64, "y": 320, "w": 64, "h": 64 } },
                "tileGrass_roadCornerLR.png": { "frame": { "x": 64, "y": 384, "w": 64, "h": 64 } },
                "tileGrass_roadCornerUL.png": { "frame": { "x": 0, "y": 64, "w": 64, "h": 64 } },
                "tileGrass_roadCornerUR.png": { "frame": { "x": 192, "y": 256, "w": 64, "h": 64 } },
                "tileGrass_roadCrossing.png": { "frame": { "x": 0, "y": 319, "w": 64, "h": 64 } },
                "tileGrass_roadCrossingRound.png": { "frame": { "x": 64, "y": 0, "w": 64, "h": 64 } },
                "tileGrass_roadEast.png": { "frame": { "x": 64, "y": 128, "w": 64, "h": 64 } },
                "tileGrass_roadNorth.png": { "frame": { "x": 192, "y": 192, "w": 64, "h": 64 } },
                "tileGrass_roadSplitE.png": { "frame": { "x": 192, "y": 64, "w": 64, "h": 64 } },
                "tileGrass_roadSplitN.png": { "frame": { "x": 192, "y": 128, "w": 64, "h": 64 } },
                "tileGrass_roadSplitS.png": { "frame": { "x": 64, "y": 64, "w": 64, "h": 64 } },
                "tileGrass_roadSplitW.png": { "frame": { "x": 64, "y": 256, "w": 64, "h": 64 } },
                "tileGrass_roadTransitionE.png": { "frame": { "x": 192, "y": 0, "w": 64, "h": 64 } },
                "tileGrass_roadTransitionE_dirt.png": { "frame": { "x": 320, "y": 64, "w": 64, "h": 64 } },
                "tileGrass_roadTransitionN.png": { "frame": { "x": 320, "y": 0, "w": 64, "h": 64 } },
                "tileGrass_roadTransitionN_dirt.png": { "frame": { "x": 256, "y": 448, "w": 64, "h": 64 } },
                "tileGrass_roadTransitionS.png": { "frame": { "x": 256, "y": 384, "w": 64, "h": 64 } },
                "tileGrass_roadTransitionS_dirt.png": { "frame": { "x": 256, "y": 320, "w": 64, "h": 64 } },
                "tileGrass_roadTransitionW.png": { "frame": { "x": 256, "y": 256, "w": 64, "h": 64 } },
                "tileGrass_roadTransitionW_dirt.png": { "frame": { "x": 256, "y": 192, "w": 64, "h": 64 } },
                "tileGrass_transitionE.png": { "frame": { "x": 256, "y": 128, "w": 64, "h": 64 } },
                "tileGrass_transitionN.png": { "frame": { "x": 256, "y": 64, "w": 64, "h": 64 } },
                "tileGrass_transitionS.png": { "frame": { "x": 256, "y": 0, "w": 64, "h": 64 } },
                "tileGrass_transitionW.png": { "frame": { "x": 192, "y": 448, "w": 64, "h": 64 } },
                "tileSand1.png": { "frame": { "x": 128, "y": 0, "w": 64, "h": 64 } },
                "tileSand2.png": { "frame": { "x": 64, "y": 448, "w": 64, "h": 64 } },
                "tileSand_roadCornerLL.png": { "frame": { "x": 0, "y": 255, "w": 64, "h": 64 } },
                "tileSand_roadCornerLR.png": { "frame": { "x": 0, "y": 191, "w": 64, "h": 64 } },
                "tileSand_roadCornerUL.png": { "frame": { "x": 0, "y": 0, "w": 64, "h": 64 } },
                "tileSand_roadCornerUR.png": { "frame": { "x": 0, "y": 383, "w": 64, "h": 64 } },
                "tileSand_roadCrossing.png": { "frame": { "x": 320, "y": 128, "w": 64, "h": 64 } },
                "tileSand_roadCrossingRound.png": { "frame": { "x": 128, "y": 448, "w": 64, "h": 64 } },
                "tileSand_roadEast.png": { "frame": { "x": 128, "y": 384, "w": 64, "h": 64 } },
                "tileSand_roadNorth.png": { "frame": { "x": 128, "y": 320, "w": 64, "h": 64 } },
                "tileSand_roadSplitE.png": { "frame": { "x": 128, "y": 256, "w": 64, "h": 64 } },
                "tileSand_roadSplitN.png": { "frame": { "x": 128, "y": 192, "w": 64, "h": 64 } },
                "tileSand_roadSplitS.png": { "frame": { "x": 128, "y": 128, "w": 64, "h": 64 } },
                "tileSand_roadSplitW.png": { "frame": { "x": 128, "y": 64, "w": 64, "h": 64 } },
                "tracksDouble.png": { "frame": { "x": 438, "y": 403, "w": 41, "h": 52 } },
                "tracksLarge.png": { "frame": { "x": 439, "y": 231, "w": 41, "h": 52 } },
                "tracksSmall.png": { "frame": { "x": 476, "y": 319, "w": 37, "h": 52 } },
                "treeBrown_large.png": { "frame": { "x": 64, "y": 192, "w": 64, "h": 64 } },
                "treeBrown_leaf.png": { "frame": { "x": 312, "y": 512, "w": 8, "h": 10 } },
                "treeBrown_small.png": { "frame": { "x": 479, "y": 371, "w": 36, "h": 36 } },
                "treeBrown_twigs.png": { "frame": { "x": 506, "y": 130, "w": 26, "h": 22 } },
                "treeGreen_large.png": { "frame": { "x": 0, "y": 447, "w": 64, "h": 64 } },
                "treeGreen_leaf.png": { "frame": { "x": 328, "y": 555, "w": 8, "h": 10 } },
                "treeGreen_small.png": { "frame": { "x": 477, "y": 185, "w": 36, "h": 36 } },
                "treeGreen_twigs.png": { "frame": { "x": 506, "y": 152, "w": 26, "h": 22 } },
                "wireCrooked.png": { "frame": { "x": 432, "y": 0, "w": 44, "h": 48 } },
                "wireStraight.png": { "frame": { "x": 529, "y": 174, "w": 17, "h": 70 } }
            }
        };

        const config = {
            type: Phaser.AUTO,
            scale: {
                mode: Phaser.Scale.FIT,
                autoCenter: Phaser.Scale.CENTER_BOTH,
                width: window.innerWidth,
                height: window.innerHeight,
            },
            parent: 'game-container',
            physics: {
                default: 'arcade',
                arcade: {
                    debug: false,
                    gravity: { y: 0 }
                }
            },
            plugins: {
                global: [{
                    key: 'rexVirtualJoystick',
                    plugin: rexvirtualjoystickplugin,
                    start: true
                }, {
                    key: 'NavMeshPlugin',
                    plugin: PhaserNavMeshPlugin,
                    mapping: 'navMeshPlugin',
                    start: true
                }]
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const game = new Phaser.Game(config);

        let player;
        let cursors;
        let bullets;
        let obstacles;
        let hazards;
        let sentries = [];
        let sentryHulls;
        let objective;
        let extractionZone;
        let isObjectiveCollected = false;
        let isMissionComplete = false;
        let rayGraphics;
        let leftStick;
        let rightStick;
        let isFireButtonDown = false;
        let manualFireRequested = false;
        let currentLevel = 1;

        class Bullet extends Phaser.Physics.Arcade.Sprite {
            constructor(scene, x, y) {
                super(scene, x, y, 'tanks', 'bulletBlue3.png');
                this.bounceCount = 0;
                this.isPlayerBullet = false;
            }

            fire(x, y, rotation, isPlayerBullet) {
                this.body.reset(x, y);
                this.setActive(true);
                this.setVisible(true);
                this.setRotation(rotation);
                this.isPlayerBullet = isPlayerBullet;

                this.setFrame(isPlayerBullet ? 'bulletBlue3.png' : 'bulletRed3.png');

                const vec = new Phaser.Math.Vector2();
                vec.setToPolar(rotation - Math.PI / 2, 40);
                this.setPosition(x + vec.x, y + vec.y);

                this.scene.physics.velocityFromRotation(rotation - Math.PI / 2, 400, this.body.velocity);
                this.bounceCount = 0;
            }

            reset() {
                this.setActive(false);
                this.setVisible(false);
                this.body.stop();
            }
        }

        class Tank {
            constructor(scene, x, y, textureBody, textureBarrel) {
                this.scene = scene;
                this.x = x;
                this.y = y;

                this.hull = scene.physics.add.sprite(x, y, 'tanks', textureBody);
                this.hull.setDrag(100);
                this.hull.setAngularDrag(100);
                this.hull.setMaxVelocity(200);
                this.hull.setCollideWorldBounds(true);

                this.turret = scene.add.sprite(x, y, 'tanks', textureBarrel);
                this.turret.setOrigin(0.5, 0.7);

                this.lastFired = 0;
                this.active = true;
            }

            update() {
                if (!this.active) return;
                this.turret.x = this.hull.x;
                this.turret.y = this.hull.y;
            }

            destroy() {
                this.hull.destroy();
                this.turret.destroy();
                this.active = false;
            }
        }

        class PlayerTank extends Tank {
            constructor(scene, x, y) {
                super(scene, x, y, 'tankBody_blue_outline.png', 'tankBlue_barrel1_outline.png');
                this.speed = 150;
            }

            update(time, cursors, pointer) {
                if (!this.active) return;
                super.update();

                this.hull.setVelocity(0);

                const velocity = new Phaser.Math.Vector2();

                if (cursors.left.isDown || cursors.a.isDown) {
                    velocity.x -= 1;
                } else if (cursors.right.isDown || cursors.d.isDown) {
                    velocity.x += 1;
                }

                if (cursors.up.isDown || cursors.w.isDown) {
                    velocity.y -= 1;
                } else if (cursors.down.isDown || cursors.s.isDown) {
                    velocity.y += 1;
                }

                const terrainMultiplier = this.scene.getTerrainSpeedMultiplier ? this.scene.getTerrainSpeedMultiplier(this.hull.x, this.hull.y) : 1;
                const currentSpeed = this.speed * terrainMultiplier;

                if (velocity.length() === 0 && leftStick && leftStick.force > 0) {
                    this.scene.physics.velocityFromRotation(leftStick.rotation, leftStick.force * currentSpeed, velocity);
                } else if (velocity.length() > 0) {
                    velocity.normalize().scale(currentSpeed);
                }

                if (velocity.length() > 0) {
                    this.hull.setVelocity(velocity.x, velocity.y);

                    const angle = velocity.angle();
                    this.hull.rotation = Phaser.Math.Angle.RotateTo(this.hull.rotation, angle + Math.PI / 2, 0.1);
                }

                let targetAngle = this.turret.rotation - Math.PI / 2;
                let shouldFire = false;

                if (this.scene.sys.game.device.os.desktop) {
                    targetAngle = Phaser.Math.Angle.Between(this.hull.x, this.hull.y, pointer.worldX, pointer.worldY);
                    shouldFire = pointer.isDown;
                } else {
                    if (rightStick && rightStick.force > 0) {
                        targetAngle = rightStick.rotation;
                    }
                    if (manualFireRequested) {
                        shouldFire = true;
                        manualFireRequested = false;
                    }
                }

                this.turret.rotation = targetAngle + Math.PI / 2;

                if (shouldFire && time > this.lastFired) {
                    const bullet = bullets.get();
                    if (bullet) {
                        bullet.fire(this.hull.x, this.hull.y, this.turret.rotation, true);
                        this.lastFired = time + 500;

                        sentries.forEach(sentry => {
                            if (sentry.active) {
                                const dist = Phaser.Math.Distance.Between(this.hull.x, this.hull.y, sentry.hull.x, sentry.hull.y);
                                if (dist < 600) {
                                    sentry.state = 'CHASE';
                                    sentry.alertUI();
                                }
                            }
                        });
                    }
                }
            }
        }

        class SentryTank extends Tank {
            constructor(scene, path) {
                super(scene, path[0].x, path[0].y, 'tankBody_darkLarge_outline.png', 'tankDark_barrel1_outline.png');
                this.patrolPath = path;
                this.patrolIndex = 0;
                this.speed = 80;
                this.visionRange = 250;
                this.visionAngle = Phaser.Math.DegToRad(45);
                this.state = 'PATROL';
                this.alertTimer = 0;
                this.hull.setData('parent', this);
                this.currentNavPath = null;
                this.pathUpdateTimer = 0;
                this.currentTargetPoint = null;
            }

            update(time, player) {
                if (!this.active) return;
                super.update();

                if (isMissionComplete) return;

                if (isObjectiveCollected && this.state !== 'CHASE' && this.state !== 'ALERT') {
                    this.state = 'CHASE';
                }

                switch (this.state) {
                    case 'PATROL':
                        this.patrolBehavior(time);
                        if (this.canSeePlayer(player)) {
                            this.state = 'CHASE';
                            this.alertUI();
                        }
                        break;
                    case 'CHASE':
                        this.chaseBehavior(time, player);
                        break;
                }
            }

            patrolBehavior(time) {
                const target = this.patrolPath[this.patrolIndex];

                this.navigateToward(target, time);

                const dist = Phaser.Math.Distance.Between(this.hull.x, this.hull.y, target.x, target.y);
                if (dist < 10) {
                    this.patrolIndex = (this.patrolIndex + 1) % this.patrolPath.length;
                }
            }

            chaseBehavior(time, player) {
                if (!player.active) return;

                this.navigateToward({ x: player.hull.x, y: player.hull.y }, time);

                const angle = Phaser.Math.Angle.Between(this.hull.x, this.hull.y, player.hull.x, player.hull.y);
                this.turret.rotation = angle + Math.PI / 2;

                const facingAngle = this.hull.rotation - Math.PI / 2;
                const turretAngle = this.turret.rotation - Math.PI / 2;
                const diff = Phaser.Math.Angle.Wrap(angle - turretAngle);

                if (Math.abs(diff) < 0.2 && time > this.lastFired && this.canSeePlayer(player)) {
                    const bullet = bullets.get();
                    if (bullet) {
                        bullet.fire(this.hull.x, this.hull.y, this.turret.rotation, false);
                        this.lastFired = time + 1500;
                    }
                }
            }

            navigateToward(targetPos, time) {
                if (time > this.pathUpdateTimer || !this.currentNavPath) {
                    this.pathUpdateTimer = time + 500;
                    if (this.scene.navMesh) {
                        this.currentNavPath = this.scene.navMesh.findPath(
                            { x: this.hull.x, y: this.hull.y },
                            { x: targetPos.x, y: targetPos.y }
                        );
                        if (this.currentNavPath && this.currentNavPath.length > 0) {
                            this.currentNavPath.shift();
                        }
                    }
                }

                let moveTarget = targetPos;

                if (this.currentNavPath && this.currentNavPath.length > 0) {
                    moveTarget = this.currentNavPath[0];
                    const distToWaypoint = Phaser.Math.Distance.Between(this.hull.x, this.hull.y, moveTarget.x, moveTarget.y);

                    if (distToWaypoint < 15) {
                        this.currentNavPath.shift();
                        if (this.currentNavPath.length > 0) {
                            moveTarget = this.currentNavPath[0];
                        }
                    }
                }

                this.moveTo(moveTarget.x, moveTarget.y);
            }

            moveTo(tx, ty) {
                const terrainMultiplier = this.scene.getTerrainSpeedMultiplier ? this.scene.getTerrainSpeedMultiplier(this.hull.x, this.hull.y) : 1;
                const currentSpeed = this.speed * terrainMultiplier;

                const angle = Phaser.Math.Angle.Between(this.hull.x, this.hull.y, tx, ty);
                const velocity = this.scene.physics.velocityFromRotation(angle, currentSpeed);
                this.hull.setVelocity(velocity.x, velocity.y);

                const desiredAngle = angle + Math.PI / 2;
                this.hull.rotation = Phaser.Math.Angle.RotateTo(this.hull.rotation, desiredAngle, 0.1);

                if (this.state === 'PATROL') this.turret.rotation = this.hull.rotation;
            }

            canSeePlayer(player) {
                if (!player.active) return false;
                const dist = Phaser.Math.Distance.Between(this.hull.x, this.hull.y, player.hull.x, player.hull.y);
                if (dist > this.visionRange) return false;

                const angleToPlayer = Phaser.Math.Angle.Between(this.hull.x, this.hull.y, player.hull.x, player.hull.y);
                const facingAngle = this.turret.rotation - Math.PI / 2;
                let diff = Phaser.Math.Angle.Wrap(angleToPlayer - facingAngle);

                if (Math.abs(diff) < this.visionAngle / 2) {
                    const line = new Phaser.Geom.Line(this.hull.x, this.hull.y, player.hull.x, player.hull.y);
                    let blocked = false;
                    obstacles.getChildren().forEach(obs => {
                        if (Phaser.Geom.Intersects.LineToRectangle(line, obs.body)) blocked = true;
                    });
                    return !blocked;
                }
                return false;
            }

            alertUI() {
                const startColor = Phaser.Display.Color.ValueToColor(0xffffff);
                const endColor = Phaser.Display.Color.ValueToColor(0xff0000);
                this.scene.tweens.addCounter({
                    from: 0,
                    to: 100,
                    duration: 500,
                    onUpdate: tween => {
                        const value = tween.getValue();
                        const col = Phaser.Display.Color.Interpolate.ColorWithColor(startColor, endColor, 100, value);
                        this.turret.setTint(Phaser.Display.Color.GetColor(col.r, col.g, col.b));
                    }
                });
                document.querySelectorAll('.status-ok').forEach(el => {
                    el.className = 'status-alert';
                    el.innerText = 'DANGER';
                });
            }

            explode() {
                const particles = this.scene.add.particles(this.hull.x, this.hull.y, 'tanks', {
                    frame: 'explosion1.png',
                    speed: 50,
                    scale: { start: 1, end: 0 },
                    duration: 500,
                    maxParticles: 10
                });
                this.destroy();
            }
        }

        function preload() {
            this.load.image('tanks_sheet', ASSET_URL);
        }

        function create() {
            this.textures.addAtlas('tanks', this.textures.get('tanks_sheet').source[0].image, ATLAS_JSON);

            cursors = this.input.keyboard.createCursorKeys();
            cursors.w = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W);
            cursors.a = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
            cursors.s = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S);
            cursors.d = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);

            const LEVEL_WIDTH = 1600;
            const LEVEL_HEIGHT = 1200;

            this.physics.world.setBounds(0, 0, LEVEL_WIDTH, LEVEL_HEIGHT);
            this.cameras.main.setBounds(0, 0, LEVEL_WIDTH, LEVEL_HEIGHT);

            this.tileGrid = [];
            const cols = Math.ceil(LEVEL_WIDTH / 64);
            const rows = Math.ceil(LEVEL_HEIGHT / 64);

            for (let y = 0; y < rows; y++) {
                this.tileGrid[y] = [];
                for (let x = 0; x < cols; x++) {
                    const isSand = Math.random() < 0.3;
                    const tileType = isSand ?
                        (Math.random() < 0.5 ? 'tileSand1.png' : 'tileSand2.png') :
                        (Math.random() < 0.5 ? 'tileGrass1.png' : 'tileGrass2.png');

                    this.add.image(x * 64 + 32, y * 64 + 32, 'tanks', tileType).setTint(0x777777);
                    this.tileGrid[y][x] = isSand ? 'sand' : 'grass';
                }
            }

            this.getTerrainSpeedMultiplier = (x, y) => {
                const col = Math.floor(x / 64);
                const row = Math.floor(y / 64);
                if (row >= 0 && row < this.tileGrid.length && col >= 0 && col < this.tileGrid[0].length) {
                    return this.tileGrid[row][col] === 'sand' ? 0.6 : 1.0;
                }
                return 1.0;
            };

            obstacles = this.physics.add.staticGroup();
            hazards = this.physics.add.staticGroup();
            bullets = this.physics.add.group({
                classType: Bullet,
                maxSize: 50,
                runChildUpdate: false
            });
            sentryHulls = this.physics.add.group();
            sentries = [];

            this.physics.add.collider(bullets, obstacles, (bullet, obstacle) => {
                if (!bullet.active) return;

                if (obstacle.frame.name.includes('crateWood')) {
                    obstacle.destroy();
                    bullet.reset();
                    return;
                }

                if (bullet.bounceCount < 1) {
                    bullet.bounceCount++;
                    const body = bullet.body;
                    if (body.touching.up || body.touching.down) body.velocity.y *= -1;
                    if (body.touching.left || body.touching.right) body.velocity.x *= -1;
                    bullet.rotation = body.velocity.angle() + Math.PI / 2;
                } else {
                    bullet.reset();
                    if (obstacle.texture.key === 'tanks' && obstacle.frame.name.includes('crate')) {
                        obstacle.destroy();
                    }
                }
            }, (bullet, obstacle) => {
                if (obstacle.frame.name === 'treeGreen_small.png') return false;
                return true;
            });


            rayGraphics = this.add.graphics();

            createMobileControls.call(this);

            startLevel.call(this, currentLevel);
        }

        function startLevel(levelNum) {
            currentLevel = levelNum;
            isMissionComplete = false;
            isObjectiveCollected = false;
            document.getElementById('mission-status').style.display = 'block';
            document.getElementById('mission-status').innerText = 'LEVEL ' + levelNum + ' START';
            document.getElementById('mission-status').style.color = '#00d2ff';
            document.getElementById('mission-status').style.borderColor = '#00d2ff';

            this.time.delayedCall(2000, () => {
                if (!isMissionComplete) document.getElementById('mission-status').style.display = 'none';
            });

            document.querySelectorAll('.status-alert').forEach(el => {
                el.className = 'status-ok';
                el.innerText = 'ACTIVE';
            });

            if (player) {
                player.destroy();
                player = null;
            }
            obstacles.clear(true, true);
            hazards.clear(true, true);
            bullets.clear(true, true);
            if (sentries.length > 0) {
                sentries.forEach(s => s.destroy());
            }
            sentryHulls.clear(true, true);
            sentries = [];
            if (objective) objective.destroy();
            if (extractionZone) extractionZone.destroy();

            const LEVEL_WIDTH = 1600;
            const LEVEL_HEIGHT = 1200;

            const TILE_SIZE = 64;
            const cols = Math.ceil(LEVEL_WIDTH / TILE_SIZE);
            const rows = Math.ceil(LEVEL_HEIGHT / TILE_SIZE);
            const grid = Array(rows).fill().map(() => Array(cols).fill(0));

            for (let y = 0; y < rows; y++) {
                grid[y][0] = 1;
                grid[y][cols - 1] = 1;
            }
            for (let x = 0; x < cols; x++) {
                grid[0][x] = 1;
                grid[rows - 1][x] = 1;
            }

            const obstacleCount = 30 + (levelNum * 5);
            let obstaclesPlaced = 0;
            while (obstaclesPlaced < obstacleCount) {
                const c = Phaser.Math.Between(1, cols - 2);
                const r = Phaser.Math.Between(1, rows - 2);
                if (grid[r][c] === 0) {
                    grid[r][c] = 1;
                    const x = c * TILE_SIZE + TILE_SIZE / 2;
                    const y = r * TILE_SIZE + TILE_SIZE / 2;
                    const type = Phaser.Math.RND.pick(['crateMetal.png', 'crateWood.png', 'barrelRust_top.png', 'treeGreen_small.png']);
                    obstacles.create(x, y, 'tanks', type).setTint(0x777777);
                    obstaclesPlaced++;
                }
            }

            const findSpawn = () => {
                let attempts = 0;
                while (attempts < 1000) {
                    const c = Phaser.Math.Between(1, cols - 2);
                    const r = Phaser.Math.Between(1, rows - 2);
                    if (grid[r][c] === 0) {
                        return { x: c * TILE_SIZE + TILE_SIZE / 2, y: r * TILE_SIZE + TILE_SIZE / 2, c, r };
                    }
                    attempts++;
                }
                return { x: 200, y: 200 };
            };

            const pSpawn = findSpawn();
            player = new PlayerTank(this, pSpawn.x, pSpawn.y);
            this.cameras.main.startFollow(player.hull);


            try {
                if (this.navMeshPlugin) {
                    const map = this.make.tilemap({ data: grid, tileWidth: TILE_SIZE, tileHeight: TILE_SIZE });
                    const tileset = map.addTilesetImage('tanks_sheet');
                    if (tileset) {
                        const layer = map.createLayer(0, tileset, 0, 0);
                        layer.setVisible(false);
                        map.setCollision(1);
                        this.navMesh = this.navMeshPlugin.buildMeshFromTilemap("navMesh", map, [layer], (tile) => tile.index === 0);
                    } else {
                        console.warn("Retrying with 'tanks' atlas as fallback for tileset...");

                    }
                }
            } catch (e) {
                console.error("NavMesh setup failed:", e);
                this.navMesh = null;
            }

            let oSpawn = findSpawn();
            while (Phaser.Math.Distance.Between(pSpawn.x, pSpawn.y, oSpawn.x, oSpawn.y) < 800) {
                oSpawn = findSpawn();
            }
            objective = this.physics.add.image(oSpawn.x, oSpawn.y, 'tanks', 'specialBarrel1_outline.png');

            extractionZone = this.add.rectangle(pSpawn.x, pSpawn.y, 120, 120, 0x00ff00, 0.2);
            this.physics.add.existing(extractionZone, true);

            const enemyCount = 2 + Math.floor(levelNum * 1.5);
            for (let i = 0; i < enemyCount; i++) {
                let eSpawn = findSpawn();
                while (Phaser.Math.Distance.Between(pSpawn.x, pSpawn.y, eSpawn.x, eSpawn.y) < 500) {
                    eSpawn = findSpawn();
                }

                const path = [{ x: eSpawn.x, y: eSpawn.y }];
                let p2 = findSpawn();
                path.push({ x: p2.x, y: p2.y });

                const s = new SentryTank(this, path);
                sentries.push(s);
                sentryHulls.add(s.hull);
            }

            this.physics.add.collider(player.hull, obstacles);
            this.physics.add.collider(player.hull, sentryHulls);

            this.physics.add.collider(sentryHulls, obstacles);

            this.physics.add.overlap(bullets, player.hull, (hull, bullet) => {
                if (!bullet.active || bullet.isPlayerBullet) return;
                bullet.reset();
                player.destroy();
                document.getElementById('mission-status').style.display = 'block';
                document.getElementById('mission-status').innerText = 'MISSION FAILED - RESTARTING...';
                document.getElementById('mission-status').style.color = '#e74c3c';
                document.getElementById('mission-status').style.borderColor = '#e74c3c';

                this.time.delayedCall(3000, () => {
                    startLevel.call(this, currentLevel);
                });
            });

            this.physics.add.overlap(bullets, sentryHulls, (bullet, hull) => {
                if (!bullet.active || !bullet.isPlayerBullet) return;
                bullet.reset();
                const sentry = hull.getData('parent');
                if (sentry && sentry.active) {
                    sentry.explode();
                }
            });


            this.physics.add.overlap(player.hull, objective, () => {
                isObjectiveCollected = true;
                objective.destroy();
                document.getElementById('mission-status').style.display = 'block';
                document.getElementById('mission-status').innerText = 'OBJECTIVE SECURED! RETURN TO EXTRACT!';
                document.getElementById('mission-status').style.color = '#e67e22';
            });

            this.physics.add.overlap(player.hull, extractionZone, () => {
                if (isObjectiveCollected && !isMissionComplete) {
                    isMissionComplete = true;
                    player.hull.setVelocity(0);
                    player.hull.body.stop();
                    sentries.forEach(s => {
                        if (s.hull && s.hull.body) {
                            s.hull.setVelocity(0);
                            s.hull.body.stop();
                        }
                    });
                    document.getElementById('mission-status').innerText = 'MISSION ACCOMPLISHED! NEXT LEVEL...';
                    document.getElementById('mission-status').style.color = '#2ecc71';

                    this.time.delayedCall(3000, () => {
                        startLevel.call(this, currentLevel + 1);
                    });
                }
            });
        }

        function createMobileControls() {
            if (this.sys.game.device.os.desktop) return;

            const width = this.scale.width;
            const height = this.scale.height;

            let radius = 100;
            let baseX1 = 150;
            let baseX2 = width - 150;
            let baseY = height - 150;

            if (width < 600) {
                radius = 60;
                baseX1 = width * 0.25;
                baseX2 = width * 0.75;
                baseY = height - 100;
            }

            leftStick = this.plugins.get('rexVirtualJoystick').add(this, {
                x: baseX1,
                y: baseY,
                radius: radius,
                base: this.add.circle(0, 0, radius, 0x888888).setAlpha(0.5).setDepth(100),
                thumb: this.add.circle(0, 0, radius * 0.5, 0xcccccc).setAlpha(0.8).setDepth(100),
                dir: '8dir',
                forceMin: 16,
                enable: true
            });

            rightStick = this.plugins.get('rexVirtualJoystick').add(this, {
                x: baseX2,
                y: baseY,
                radius: radius,
                base: this.add.circle(0, 0, radius, 0x888888).setAlpha(0.5).setDepth(100),
                thumb: this.add.circle(0, 0, radius * 0.5, 0xcccccc).setAlpha(0.8).setDepth(100),
                dir: '8dir',
                forceMin: 16,
                enable: true
            });

            this.input.addPointer(1);

            rightStick.on('pointerdown', () => {
                rightStick.clickStartTime = Date.now();
            });
            rightStick.on('pointerup', () => {
                const duration = Date.now() - rightStick.clickStartTime;
                if (duration < 200) {
                    manualFireRequested = true;
                }
            });
        }

        function update(time, delta) {
            if (isMissionComplete) return;

            player.update(time, cursors, this.input.activePointer);
            sentries.forEach(s => s.update(time, player));

            rayGraphics.clear();

            sentries.forEach(s => {
                if (!s.active) return;
                rayGraphics.fillStyle(0xff0000, 0.4);
                const startAngle = s.turret.rotation - Math.PI / 2 - s.visionAngle / 2;
                rayGraphics.slice(s.hull.x, s.hull.y, s.visionRange, startAngle, startAngle + s.visionAngle, false);
                rayGraphics.fillPath();
            });
        }
    </script>
</body>

</html>